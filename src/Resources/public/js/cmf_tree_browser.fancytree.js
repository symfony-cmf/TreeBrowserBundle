!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=53)}([function(e,t,n){var r=n(49)("wks"),i=n(14),o=n(2).Symbol;e.exports=function(e){return r[e]||(r[e]=o&&o[e]||(o||i)("Symbol."+e))}},function(e,t,n){var r=n(3),i=n(23);e.exports=n(13)?function(e,t,n){return r.setDesc(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t){e.exports={}},function(e,t,n){var r=n(2),i=n(1),o=n(14)("src"),a=Function.toString,s=(""+a).split("toString");n(6).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,n,a){"function"==typeof n&&(n.hasOwnProperty(o)||i(n,o,e[t]?""+e[t]:s.join(String(t))),n.hasOwnProperty("name")||i(n,"name",t)),e===r?e[t]=n:(a||delete e[t],i(e,t,n))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||a.call(this)})},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(3).setDesc,i=n(9),o=n(0)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(45);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";var r=n(46),i=n(20),o=n(5),a=n(1),s=n(9),l=n(4),d=n(44),c=n(8),u=n(3).getProto,h=n(0)("iterator"),f=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,g,v,y,b){d(n,t,g);var m,x,_=function(e){if(!f&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",N="values"==v,w=!1,S=e.prototype,C=S[h]||S["@@iterator"]||v&&S[v],E=C||_(v);if(C){var T=u(E.call(new e));c(T,k,!0),!r&&s(S,"@@iterator")&&a(T,h,p),N&&"values"!==C.name&&(w=!0,E=function(){return C.call(this)})}if(r&&!b||!f&&!w&&S[h]||a(S,h,E),l[t]=E,l[k]=p,v)if(m={values:N?E:_("values"),keys:y?E:_("keys"),entries:N?_("entries"):E},b)for(x in m)x in S||o(S,x,m[x]);else i(i.P+i.F*(f||w),t,m);return m}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){e.exports=!n(22)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(7);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(10),i=n(36),o=n(35),a=n(15),s=n(34),l=n(33);e.exports=function(e,t,n,d){var c,u,h,f=l(e),p=r(n,d,t?2:1),g=0;if("function"!=typeof f)throw TypeError(e+" is not iterable!");if(o(f))for(c=s(e.length);c>g;g++)t?p(a(u=e[g])[0],u[1]):p(e[g]);else for(h=f.call(e);!(u=h.next()).done;)i(h,p,u.value,t)}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError(n+": use the 'new' operator!");return e}},function(e,t,n){var r=n(5);e.exports=function(e,t){for(var n in t)r(e,n,t[n]);return e}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(2),i=n(6),o=n(1),a=n(5),s=n(10),l=function(e,t,n){var d,c,u,h,f=e&l.F,p=e&l.G,g=e&l.S,v=e&l.P,y=e&l.B,b=p?r:g?r[t]||(r[t]={}):(r[t]||{}).prototype,m=p?i:i[t]||(i[t]={}),x=m.prototype||(m.prototype={});for(d in p&&(n=t),n)u=((c=!f&&b&&d in b)?b:n)[d],h=y&&c?s(u,r):v&&"function"==typeof u?s(Function.call,u):u,b&&!c&&a(b,d,u),m[d]!=u&&o(m,d,h),v&&x[d]!=u&&(x[d]=u)};r.core=i,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,e.exports=l},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(24),i=n(0)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=(t=Object(e))[i])?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){e.exports=jQuery},function(e,t,n){"use strict";
/*!
 * jquery.fancytree.dnd.js
 *
 * Drag-and-drop support (jQuery UI draggable/droppable).
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2017, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.21.0
 * @date 2017-01-15T17:21:28Z
 */!function(e,t,n,r){var i=!1;function o(t){var n=t.options.dnd||null,r=t.options.glyph||null;n&&(i||(e.ui.plugin.add("draggable","connectToFancytree",{start:function(t,n){var r=e(this).data("ui-draggable")||e(this).data("draggable"),i=n.helper.data("ftSourceNode")||null;if(i)return r.offset.click.top=-2,r.offset.click.left=16,i.tree.ext.dnd._onDragEvent("start",i,null,t,n,r)},drag:function(t,n){var r,i=e(this).data("ui-draggable")||e(this).data("draggable"),o=n.helper.data("ftSourceNode")||null,a=n.helper.data("ftTargetNode")||null,s=e.ui.fancytree.getNode(t.target),l=o&&o.tree.options.dnd;t.target&&!s&&e(t.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0?(o||a||e.ui.fancytree).debug("Drag event over helper: ignored."):(n.helper.data("ftTargetNode",s),l&&l.updateHelper&&(r=o.tree._makeHookContext(o,t,{otherNode:s,ui:n,draggable:i,dropMarker:e("#fancytree-drop-marker")}),l.updateHelper.call(o.tree,o,r)),a&&a!==s&&a.tree.ext.dnd._onDragEvent("leave",a,o,t,n,i),s&&s.tree.options.dnd.dragDrop&&(s===a?s.tree.ext.dnd._onDragEvent("over",s,o,t,n,i):(s.tree.ext.dnd._onDragEvent("enter",s,o,t,n,i),s.tree.ext.dnd._onDragEvent("over",s,o,t,n,i))))},stop:function(t,n){var r=e(this).data("ui-draggable")||e(this).data("draggable"),i=n.helper.data("ftSourceNode")||null,o=n.helper.data("ftTargetNode")||null,a="mouseup"===t.type&&1===t.which;a||(i||o||e.ui.fancytree).debug("Drag was cancelled"),o&&(a&&o.tree.ext.dnd._onDragEvent("drop",o,i,t,n,r),o.tree.ext.dnd._onDragEvent("leave",o,i,t,n,r)),i&&i.tree.ext.dnd._onDragEvent("stop",i,null,t,n,r)}}),i=!0)),n&&n.dragStart&&t.widget.element.draggable(e.extend({addClasses:!1,appendTo:t.$container,containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(t){var n,i,o,a=e.ui.fancytree.getNode(t.target);return a?(o=a.tree.options.dnd,i=e(a.span),(n=e("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").css({zIndex:3,position:"relative"}).append(i.find("span.fancytree-title").clone())).data("ftSourceNode",a),r&&n.find(".fancytree-drag-helper-img").addClass(r.map.dragHelper),o.initHelper&&o.initHelper.call(a.tree,a,{node:a,tree:a.tree,originalEvent:t,ui:{helper:n}}),n):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(e,t){return!!t.helper.data("ftSourceNode")}},t.options.dnd.draggable)),n&&n.dragDrop&&t.widget.element.droppable(e.extend({addClasses:!1,tolerance:"intersect",greedy:!1},t.options.dnd.droppable))}e.ui.fancytree.registerExtension({name:"dnd",version:"2.21.0",options:{autoExpandMS:1e3,draggable:null,droppable:null,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,smartRevert:!0,dragStart:null,dragStop:null,initHelper:null,updateHelper:null,dragEnter:null,dragOver:null,dragExpand:null,dragDrop:null,dragLeave:null},treeInit:function(t){var n=t.tree;this._superApply(arguments),n.options.dnd.dragStart&&n.$container.on("mousedown",function(n){if(t.options.dnd.focusOnClick){var r=e.ui.fancytree.getNode(n);r&&r.debug("Re-enable focus that was prevented by jQuery UI draggable."),setTimeout(function(){e(n.target).closest(":tabbable").focus()},10)}}),o(n)},_setDndStatus:function(t,n,r,i,o){var a,s="center",l=this._local,d=this.options.glyph||null,c=t?e(t.span):null,u=e(n.span),h=u.find(">span.fancytree-title");if(l.$dropMarker||(l.$dropMarker=e("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo(e(this.$div).parent()),d&&l.$dropMarker.addClass(d.map.dropMarker)),"after"===i||"before"===i||"over"===i){switch(a=-24,i){case"before":s="top",a-=16;break;case"after":s="bottom",a-=16}l.$dropMarker.toggleClass("fancytree-drop-after","after"===i).toggleClass("fancytree-drop-over","over"===i).toggleClass("fancytree-drop-before","before"===i).show().position(e.ui.fancytree.fixPositionOptions({my:"left"+function(e){return 0===e?"":e>0?"+"+e:""+e}(a)+" center",at:"left "+s,of:h}))}else l.$dropMarker.hide();c&&c.toggleClass("fancytree-drop-accept",!0===o).toggleClass("fancytree-drop-reject",!1===o),u.toggleClass("fancytree-drop-target","after"===i||"before"===i||"over"===i).toggleClass("fancytree-drop-after","after"===i).toggleClass("fancytree-drop-before","before"===i).toggleClass("fancytree-drop-accept",!0===o).toggleClass("fancytree-drop-reject",!1===o),r.toggleClass("fancytree-drop-accept",!0===o).toggleClass("fancytree-drop-reject",!1===o)},_onDragEvent:function(t,r,i,o,a,s){var l,d,c,u,h,f,p,g,v,y=this.options.dnd,b=this._makeHookContext(r,o,{otherNode:i,ui:a,draggable:s}),m=null,x=this,_=e(r.span);switch(y.smartRevert&&(s.options.revert="invalid"),t){case"start":r.isStatusNode()?m=!1:y.dragStart&&(m=y.dragStart(r,b)),!1===m?(this.debug("tree.dragStart() cancelled"),a.helper.trigger("mouseup").hide()):(y.smartRevert&&(u=r[b.tree.nodeContainerAttrName].getBoundingClientRect(),c=e(s.options.appendTo)[0].getBoundingClientRect(),s.originalPosition.left=Math.max(0,u.left-c.left),s.originalPosition.top=Math.max(0,u.top-c.top)),_.addClass("fancytree-drag-source"),e(n).on("keydown.fancytree-dnd,mousedown.fancytree-dnd",function(t){"keydown"===t.type&&t.which===e.ui.keyCode.ESCAPE?x.ext.dnd._cancelDrag():"mousedown"===t.type&&x.ext.dnd._cancelDrag()}));break;case"enter":m=!!(v=(!y.preventRecursiveMoves||!r.isDescendantOf(i))&&(y.dragEnter?y.dragEnter(r,b):null))&&(e.isArray(v)?{over:e.inArray("over",v)>=0,before:e.inArray("before",v)>=0,after:e.inArray("after",v)>=0}:{over:!0===v||"over"===v,before:!0===v||"before"===v,after:!0===v||"after"===v}),a.helper.data("enterResponse",m);break;case"over":g=null,!1===(p=a.helper.data("enterResponse"))||("string"==typeof p?g=p:(d=_.offset(),f={x:(h={x:o.pageX-d.left,y:o.pageY-d.top}).x/_.width(),y:h.y/_.height()},p.after&&f.y>.75?g="after":!p.over&&p.after&&f.y>.5?g="after":p.before&&f.y<=.25?g="before":!p.over&&p.before&&f.y<=.5?g="before":p.over&&(g="over"),y.preventVoidMoves&&(r===i?(this.debug("    drop over source node prevented"),g=null):"before"===g&&i&&r===i.getNextSibling()?(this.debug("    drop after source node prevented"),g=null):"after"===g&&i&&r===i.getPrevSibling()?(this.debug("    drop before source node prevented"),g=null):"over"===g&&i&&i.parent===r&&i.isLastSibling()&&(this.debug("    drop last child over own parent prevented"),g=null)),a.helper.data("hitMode",g))),"before"===g||"after"===g||!y.autoExpandMS||!1===r.hasChildren()||r.expanded||y.dragExpand&&!1===y.dragExpand(r,b)||r.scheduleAction("expand",y.autoExpandMS),g&&y.dragOver&&(b.hitMode=g,m=y.dragOver(r,b)),l=!1!==m&&null!==g,y.smartRevert&&(s.options.revert=!l),this._local._setDndStatus(i,r,a.helper,g,l);break;case"drop":(g=a.helper.data("hitMode"))&&y.dragDrop&&(b.hitMode=g,y.dragDrop(r,b));break;case"leave":r.scheduleAction("cancel"),a.helper.data("enterResponse",null),a.helper.data("hitMode",null),this._local._setDndStatus(i,r,a.helper,"out",void 0),y.dragLeave&&y.dragLeave(r,b);break;case"stop":_.removeClass("fancytree-drag-source"),e(n).off(".fancytree-dnd"),y.dragStop&&y.dragStop(r,b);break;default:e.error("Unsupported drag event: "+t)}return m},_cancelDrag:function(){var t=e.ui.ddmanager.current;t&&t.cancel()}})}(jQuery,window,document)},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/*!
 * jquery.fancytree.js
 * Tree view control with support for lazy loading and much more.
 * https://github.com/mar10/fancytree/
 *
 * Copyright (c) 2008-2017, Martin Wendt (http://wwWendt.de)
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.21.0
 * @date 2017-01-15T17:21:28Z
 */!function(e,t,n,i){if(e.ui&&e.ui.fancytree)e.ui.fancytree.warn("Fancytree: ignored duplicate include");else{var o,a,s=null,l=new RegExp(/\.|\//),d=/[&<>"'\/]/g,c=/[<>"'\/]/g,u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},h={16:!0,17:!0,18:!0},f={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},p={0:"",1:"left",2:"middle",3:"right"},g="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),v={},y="expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable".split(" "),b={},m={},x={active:!0,children:!0,data:!0,focus:!0};for(o=0;o<g.length;o++)v[g[o]]=!0;for(o=0;o<y.length;o++)a=y[o],b[a]=!0,a!==a.toLowerCase()&&(m[a.toLowerCase()]=a);_(e.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),O.prototype={_findDirectChild:function(e){var t,n,r=this.children;if(r)if("string"==typeof e){for(t=0,n=r.length;t<n;t++)if(r[t].key===e)return r[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){_(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new O(this,e[t]))},addChildren:function(t,n){var r,i,o,a,s=[];for(e.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),r=0,i=t.length;r<i;r++)s.push(new O(this,t[r]));return a=s[0],null==n?this.children=this.children.concat(s):(n=this._findDirectChild(n),_((o=e.inArray(n,this.children))>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[o,0].concat(s))),(!this.parent||this.parent.ul||this.tr)&&this.render(),3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===s.length?s[0]:null),a},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t!==i&&"over"!==t||(t="child"),t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}_(!1,"Invalid mode: "+t)},addPagingNode:function(t,n){var r,i;if(n=n||"child",!1!==t)return t=e.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,n);for(r=this.children.length-1;r>=0;r--)"paging"===(i=this.children[r]).statusNodeType&&this.removeChild(i);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(t){if(null===t)return this.remove(),S(this);var n,r,i={children:!0,expanded:!0,parent:!0};for(n in t)r=t[n],i[n]||e.isFunction(r)||(b[n]?this[n]=r:this.data[n]=r);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):S(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,r,i=this.children;if(!i)return 0;if(r=i.length,!1!==e)for(t=0,n=r;t<n;t++)r+=i[t].countChildren();return r},debug:function(e){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),k("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},findAll:function(t){t=e.isFunction(t)?t:A(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:A(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},_changeSelectStatusAttrs:function(e){var t=!1;switch(e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case i:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:_(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var e=this.isSelected();this.visit(function(t){t._changeSelectStatusAttrs(e)}),this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){_(3===this.tree.options.selectMode,"expected selectMode 3"),function e(t){var n,r,o,a,s,l,d=t.children;if(d&&d.length){for(s=!0,l=!1,n=0,r=d.length;n<r;n++)!1!==(o=e(d[n]))&&(l=!0),!0!==o&&(s=!1);a=!!s||!!l&&i}else a=!!t.selected;return t._changeSelectStatusAttrs(a),a}(this),this.visitParents(function(e){var t,n,r,o,a=e.children,s=!0,l=!1;for(t=0,n=a.length;t<n;t++)((r=a[t]).selected||r.partsel)&&(l=!0),r.unselectable||r.selected||(s=!1);o=!!s||!!l&&i,e._changeSelectStatusAttrs(o)})},fromDict:function(t){for(var n in t)b[n]?this[n]=t[n]:"data"===n?e.extend(this.data,t.data):e.isFunction(t[n])||x[n]||(this.data[n]=t[n]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){return this.hasChildren()===i?i:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t,n){t=t||".";var r,i=[];return e.each(this.getParentList(!1,!0),function(e,t){r=""+(t.getIndex()+1),n&&(r=("0000000"+r).substr(-n)),i.push(r)}),i.join(t)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],r=t?this:this.parent;r;)(e||r.parent)&&n.unshift(r),r=r.parent;return n},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},getSelectedNodes:function(e){var t=[];return this.visit(function(n){if(n.selected&&(t.push(n),!0===e))return"skip"}),t},hasChildren:function(){return this.lazy?null==this.children?i:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||i):!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),k("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==i},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===i},isVisible:function(){var e,t,n=this.getParentList(!1,!1);for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t,n,r=this,i=this.isExpanded();return _(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(n=this.tree._triggerNodeEvent("lazyLoad",this))?S(this):(_("boolean"!=typeof n,"lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,n),i?(this.expanded=!0,t.always(function(){r.render()})):t.always(function(){r.renderStatus()}),t)):S(this)},makeVisible:function(t){var n,r=this,i=[],o=new e.Deferred,a=this.getParentList(!1,!1),s=a.length,l=!(t&&!0===t.noAnimation),d=!(t&&!1===t.scrollIntoView);for(n=s-1;n>=0;n--)i.push(a[n].setExpanded(!0,t));return e.when.apply(e,i).done(function(){d?r.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(t,n,r){n===i||"over"===n?n="child":"firstChild"===n&&(t.children&&t.children.length?(n="before",t=t.children[0]):n="child");var o,a=this.parent,s="child"===n?t:t.parent;if(this!==t){if(this.parent?s.isDescendantOf(this)&&e.error("Cannot move a node to its own descendant"):e.error("Cannot move system root"),s!==a&&a.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===s)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else _((o=e.inArray(this,this.parent.children))>=0,"invalid source parent"),this.parent.children.splice(o,1);if(this.parent=s,s.hasChildren())switch(n){case"child":s.children.push(this);break;case"before":_((o=e.inArray(t,s.children))>=0,"invalid target parent"),s.children.splice(o,0,this);break;case"after":_((o=e.inArray(t,s.children))>=0,"invalid target parent"),s.children.splice(o+1,0,this);break;default:e.error("Invalid mode "+n)}else s.children=[this];r&&t.visit(r,!0),s===a?s.triggerModifyChild("move",this):s.triggerModifyChild("add",this),this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(e){e.tree=t.tree},!0)),a.isDescendantOf(s)||a.render(),s.isDescendantOf(a)||s===a||s.render()}},navigate:function(t,n){var r,i,o,a=e.ui.keyCode,s=null;function l(r){if(r){try{r.makeVisible({scrollIntoView:!1})}catch(e){}return e(r.span).is(":visible")?!1===n?r.setFocus():r.setActive():(r.debug("Navigate: skipping hidden node"),void r.navigate(t,n))}}switch(t){case a.BACKSPACE:this.parent&&this.parent.parent&&(o=l(this.parent));break;case a.HOME:this.tree.visit(function(t){if(e(t.span).is(":visible"))return o=l(t),!1});break;case a.END:this.tree.visit(function(t){e(t.span).is(":visible")&&(o=t)}),o&&(o=l(o));break;case a.LEFT:this.expanded?(this.setExpanded(!1),o=l(this)):this.parent&&this.parent.parent&&(o=l(this.parent));break;case a.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(o=l(this.children[0])):(this.setExpanded(),o=l(this));break;case a.UP:for(s=this.getPrevSibling();s&&!e(s.span).is(":visible");)s=s.getPrevSibling();for(;s&&s.expanded&&s.children&&s.children.length;)s=s.children[s.children.length-1];!s&&this.parent&&this.parent.parent&&(s=this.parent),o=l(s);break;case a.DOWN:if(this.expanded&&this.children&&this.children.length)s=this.children[0];else for(r=(i=this.getParentList(!1,!0)).length-1;r>=0;r--){for(s=i[r].getNextSibling();s&&!e(s.span).is(":visible");)s=s.getNextSibling();if(s)break}o=l(s);break;default:!1}return o||S()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(t){var n,r=this.parent,i=e.inArray(this,r.children),a=this;return _(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(n=this.tree._callHook("nodeLoadChildren",this,t)).done(function(e){var t=a.children;for(o=0;o<t.length;o++)t[o].parent=r;r.children.splice.apply(r.children,[i+1,0].concat(t)),a.children=null,a.remove(),r.render()}).fail(function(){a.setExpanded()}),n},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=i,this.renderStatus()},scheduleAction:function(t,n){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var r=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){r.tree.debug("setTimeout: trigger expand"),r.setExpanded(!0)},n);break;case"activate":this.tree.timer=setTimeout(function(){r.tree.debug("setTimeout: trigger activate"),r.setActive(!0)},n);break;default:e.error("Invalid mode "+t)}},scrollIntoView:function(r,o){o!==i&&function(e){return!(!e.tree||e.statusNodeType===i)}(o)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),o={topNode:o});var a,s,l,d=e.extend({effects:!0===r?{duration:200,queue:!1}:r,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},o),c=new e.Deferred,u=this,h=e(this.span).height(),f=e(d.scrollParent),p=d.scrollOfs.top||0,g=d.scrollOfs.bottom||0,v=f.height(),y=f.scrollTop(),b=f,m=f[0]===t,x=d.topNode||null,k=null;return e(this.span).is(":visible")?(m?(s=e(this.span).offset().top,a=x&&x.span?e(x.span).offset().top:0,b=e("html,body")):(_(f[0]!==n&&f[0]!==n.body,"scrollParent should be a simple element or `window`, not document or body."),l=f.offset().top,s=e(this.span).offset().top-l+y,a=x?e(x.span).offset().top-l+y:0,v-=Math.max(0,f.innerHeight()-f[0].clientHeight)),s<y+p?k=s-p:s+h>y+v-g&&(k=s+h-v+g,x&&(_(x.isRootNode()||e(x.span).is(":visible"),"topNode must be visible"),a<k&&(k=a-p))),null!==k?d.effects?(d.effects.complete=function(){c.resolveWith(u)},b.stop(!0).animate({scrollTop:k},d.effects)):(b[0].scrollTop=k,c.resolveWith(this)):c.resolveWith(this),c.promise()):(this.warn("scrollIntoView(): node is invisible."),S())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e){return this.tree._callHook("nodeSetSelected",this,e)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,r,i=this.children;if(i){if(e=e||function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();return n===r?0:n>r?1:-1},i.sort(e),t)for(n=0,r=i.length;n<r;n++)i[n].children&&i[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(t,n){var r,i,o,a={},s=this;if(e.each(y,function(e,t){(s[t]||!1===s[t])&&(a[t]=s[t])}),e.isEmptyObject(this.data)||(a.data=e.extend({},this.data),e.isEmptyObject(a.data)&&delete a.data),n&&n(a,s),t&&this.hasChildren())for(a.children=[],r=0,i=this.children.length;r<i;r++)(o=this.children[r]).isStatusNode()||a.children.push(o.toDict(!0,n));return a},toggleClass:function(t,n){var r,o,a=t.match(/\S+/g)||[],s=0,l=!1,d=this[this.tree.statusClassPropName],c=" "+(this.extraClasses||"")+" ";for(d&&e(d).toggleClass(t,n);r=a[s++];)if(o=c.indexOf(" "+r+" ")>=0,n=n===i?!o:!!n)o||(c+=r+" ",l=!0);else for(;c.indexOf(" "+r+" ")>-1;)c=c.replace(" "+r+" "," ");return this.extraClasses=e.trim(c),l},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},triggerModifyChild:function(t,n,r){var i,o=this.tree.options.modifyChild;o&&(n&&n.parent!==this&&e.error("childNode "+n+" is not a child of "+this),i={node:this,tree:this.tree,operation:t,childNode:n||null},r&&e.extend(i,r),o({type:"modifyChild"},i))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,r,i=!0,o=this.children;if(!0===t&&(!1===(i=e(this))||"skip"===i))return i;if(o)for(n=0,r=o.length;n<r&&!1!==(i=o[n].visit(e,!0));n++);return i},visitAndLoad:function(t,n,r){var i,o,a,s=this;return!t||!0!==n||!1!==(o=t(s))&&"skip"!==o?s.children||s.lazy?(i=new e.Deferred,a=[],s.load().done(function(){for(var n=0,r=s.children.length;n<r;n++){if(!1===(o=s.children[n].visitAndLoad(t,!0,!0))){i.reject();break}"skip"!==o&&a.push(o)}e.when.apply(this,a).then(function(){i.resolve()})}),i.promise()):S():r?o:S()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),k("warn",arguments)}},F.prototype={_makeHookContext:function(t,n,r){var o,a;return t.node!==i?(n&&t.originalEvent!==n&&e.error("invalid args"),o=t):t.tree?o={node:t,tree:a=t.tree,widget:a.widget,options:a.widget.options,originalEvent:n}:t.widget?o={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:n}:e.error("invalid args"),r&&e.extend(o,r),o},_callHook:function(t,n,r){var i=this._makeHookContext(n),o=this[t],a=Array.prototype.slice.call(arguments,2);return e.isFunction(o)||e.error("_callHook('"+t+"') is not a function"),a.unshift(i),o.apply(this,a)},_requireExtension:function(t,n,r,i){r=!!r;var o=this._local.name,a=this.options.extensions,s=e.inArray(t,a)<e.inArray(o,a),l=n&&null==this.ext[t],d=!l&&null!=r&&r!==s;return _(o&&o!==t,"invalid or same name"),!l&&!d||(i||(l||n?(i="'"+o+"' extension requires '"+t+"'",d&&(i+=" to be registered "+(r?"before":"after")+" itself")):i="If used together, `"+t+"` must be registered "+(r?"before":"after")+" `"+o+"`"),e.error(i),!1)},activateKey:function(e){var t=this.getNodeByKey(e);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyPatch:function(t){var n,r,i,o,a,s,l=t.length,d=[];for(r=0;r<l;r++)_(2===(i=t[r]).length,"patchList must be an array of length-2-arrays"),o=i[0],a=i[1],(s=null===o?this.rootNode:this.getNodeByKey(o))?(n=new e.Deferred,d.push(n),s.applyPatch(a).always(E(n,s))):this.warn("could not find node with key '"+o+"'");return e.when.apply(e,d).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),k("log",arguments))},enableUpdate:function(e){return e=!1!==e,!!this._enableUpdate==!!e?e:(this._enableUpdate=e,e?(this.debug("enableUpdate(true): redraw ",this._dirtyRoots),this.render()):this.debug("enableUpdate(false)..."),!e)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n,r){var i=null,o=n.parent.children,a=null;return t="string"==typeof t?function(e){var t=new RegExp("^"+e,"i");return function(e){return t.test(e.title)}}(t):t,function e(t,n,r){var i,o,a=t.children,s=a.length,l=a[n];if(l&&!1===r(l))return!1;if(l&&l.children&&l.expanded&&!1===e(l,0,r))return!1;for(i=n+1;i<s;i++)if(!1===e(t,i,r))return!1;return(o=t.parent)?e(o,o.children.indexOf(t)+1,r):e(t,0,r)}((n=n||this.getFirstChild()).parent,o.indexOf(n),function(r){return r!==i&&(i=i||r,e(r.span).is(":visible")?(!t(r)||(a=r)===n)&&void 0:void r.debug("quicksearch: skipping hidden node"))}),a},generateFormElements:function(t,n,r){r=r||{};var i,o="string"==typeof t?t:"ft_"+this._id+"[]",a="string"==typeof n?n:"ft_"+this._id+"_active",s="fancytree_result_"+this._id,l=e("#"+s),d=3===this.options.selectMode&&!1!==r.stopOnParents;function c(t){l.append(e("<input>",{type:"checkbox",name:o,value:t.key,checked:!0}))}l.length?l.empty():l=e("<div>",{id:s}).hide().insertAfter(this.$container),!1!==n&&this.activeNode&&l.append(e("<input>",{type:"radio",name:a,value:this.activeNode.key,checked:!0})),r.filter?this.visit(function(e){var t=r.filter(e);if("skip"===t)return t;!1!==t&&c(e)}):!1!==t&&(i=this.getSelectedNodes(d),e.each(i,function(e,t){c(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(e,t){var r,i;return!t&&(r=n.getElementById(this.options.idPrefix+e))?r.ftnode?r.ftnode:null:(t=t||this.rootNode,i=null,t.visit(function(t){if(t.key===e)return i=t,!1},!0),i)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),k("info",arguments))},loadKeyPath:function(t,n,r){var o,a,s,l,d,c,u,h,f,p=this.options.keyPathSeparator,g=this;for(n=n||e.noop,e.isArray(t)||(t=[t]),c={},s=0;s<t.length;s++)for(h=r||this.rootNode,(l=t[s]).charAt(0)===p&&(l=l.substr(1)),f=l.split(p);f.length;){if(d=f.shift(),!(u=h._findDirectChild(d))){this.warn("loadKeyPath: key not found: "+d+" (parent: "+h+")"),n.call(this,d,"error");break}if(0===f.length){n.call(this,u,"ok");break}if(u.lazy&&u.hasChildren()===i){n.call(this,u,"loaded"),c[d]?c[d].push(f.join(p)):c[d]=[f.join(p)];break}n.call(this,u,"loaded"),h=u}function v(e,t,r){n.call(g,t,"loading"),t.load().done(function(){g.loadKeyPath.call(g,c[e],n,t).always(E(r,g))}).fail(function(i){g.warn("loadKeyPath: error loading: "+e+" (parent: "+h+")"),n.call(g,t,"error"),r.reject()})}for(d in o=[],c)null==(u=h._findDirectChild(d))&&(u=g.getNodeByKey(d)),a=new e.Deferred,o.push(a),v(d,u,a);return e.when.apply(e,o).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):S()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(e,t,n,r){var o=this._makeHookContext(t,n,r),a=this.widget._trigger(e,n,o);return!1!==a&&o.result!==i?o.result:a},_triggerTreeEvent:function(e,t,n){var r=this._makeHookContext(this,t,n),o=this.widget._trigger(e,t,r);return!1!==o&&r.result!==i?r.result:o},visit:function(e){return this.rootNode.visit(e,!1)},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),k("warn",arguments)}},e.extend(F.prototype,{nodeClick:function(e){var t,n,r=e.targetType,i=e.node;if("expander"===r){if(i.isLoading())return void i.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===r)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(n=!1,t=!0,i.folder)switch(e.options.clickFolderMode){case 2:n=!0,t=!1;break;case 3:t=!0,n=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,r,i,o=e.node;if(o.parent)for(r=0,i=(n=o.parent.children).length;r<i;r++)n[r]!==o&&n[r].expanded&&this._callHook("nodeSetExpanded",n[r],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var n,r,i,o=t.originalEvent,a=t.node,l=t.tree,d=t.options,c=o.which,u=String.fromCharCode(c),h=!(o.altKey||o.ctrlKey||o.metaKey||o.shiftKey),p=e(o.target),g=!0,v=!(o.ctrlKey||!d.autoActivate);if(a||(i=this.getActiveNode()||this.getFirstChild())&&(i.setFocus(),(a=t.node=this.focusNode).debug("Keydown force focus on active node")),d.quicksearch&&h&&/\w/.test(u)&&!f[c]&&!p.is(":input:enabled"))return(r=(new Date).getTime())-l.lastQuicksearchTime>500&&(l.lastQuicksearchTerm=""),l.lastQuicksearchTime=r,l.lastQuicksearchTerm+=u,(n=l.findNextNode(l.lastQuicksearchTerm,l.getActiveNode()))&&n.setActive(),void o.preventDefault();switch(s.eventToString(o)){case"+":case"=":l.nodeSetExpanded(t,!0);break;case"-":l.nodeSetExpanded(t,!1);break;case"space":a.isPagingNode()?l._triggerNodeEvent("clickPaging",t,o):d.checkbox?l.nodeToggleSelected(t):l.nodeSetActive(t,!0);break;case"return":l.nodeSetActive(t,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":a.navigate(o.which,v,!0);break;default:g=!1}g&&o.preventDefault()},nodeLoadChildren:function(t,n){var r,i,o,a=t.tree,s=t.node,l=(new Date).getTime();return e.isFunction(n)&&(n=n.call(a,{type:"source"},t),_(!e.isFunction(n),"source callback must not return another function")),n.url&&(s._requestId&&s.warn("Recursive load request #"+l+" while #"+s._requestId+" is pending."),r=e.extend({},t.options.ajax,n),s._requestId=l,r.debugDelay?(i=r.debugDelay,e.isArray(i)&&(i=i[0]+Math.random()*(i[1]-i[0])),s.warn("nodeLoadChildren waiting debugDelay "+Math.round(i)+" ms ..."),r.debugDelay=!1,o=e.Deferred(function(t){setTimeout(function(){e.ajax(r).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},i)})):o=e.ajax(r),n=new e.Deferred,o.done(function(r,i,o){var d,c;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof r||e.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),s._requestId&&s._requestId>l)n.rejectWith(this,["$recursive_request"]);else{if(t.options.postProcess){try{c=a._triggerNodeEvent("postProcess",t,t.originalEvent,{response:r,error:null,dataType:this.dataType})}catch(e){c={error:e,message:""+e,details:"postProcess failed"}}if(c.error)return d=e.isPlainObject(c.error)?c.error:{message:c.error},d=a._makeHookContext(s,null,d),void n.rejectWith(this,[d]);r=e.isArray(c)?c:r}else r&&r.hasOwnProperty("d")&&t.options.enableAspx&&(r="string"==typeof r.d?e.parseJSON(r.d):r.d);n.resolveWith(this,[r])}}).fail(function(e,t,r){var i=a._makeHookContext(s,null,{error:e,args:Array.prototype.slice.call(arguments),message:r,details:e.status+": "+r});n.rejectWith(this,[i])})),e.isFunction(n.then)&&e.isFunction(n.catch)&&(o=n,n=new e.Deferred,o.then(function(e){n.resolve(e)},function(e){n.reject(e)})),e.isFunction(n.promise)&&(a.nodeSetStatus(t,"loading"),n.done(function(e){a.nodeSetStatus(t,"ok"),s._requestId=null}).fail(function(e){var n;"$recursive_request"!==e?(e.node&&e.error&&e.message?n=e:"[object Object]"===(n=a._makeHookContext(s,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(n.message=""),s.warn("Load children failed ("+n.message+")",n),!1!==a._triggerNodeEvent("loadError",n,null)&&a.nodeSetStatus(t,"error",n.message,n.details)):s.warn("Ignored response for obsolete load request #"+l+" (expected #"+s._requestId+")")})),e.when(n).done(function(t){var n;e.isPlainObject(t)&&(_(s.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),_(e.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),n=t,t=t.children,delete n.children,e.extend(a.data,n)),_(e.isArray(t),"expected array of children"),s._setChildren(t),a._triggerNodeEvent("loadChildren",s)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(t,n){var r,i=t.node,o=e.extend({},t,{node:n}),a=i.children;if(1===a.length)return _(n===a[0],"invalid single child"),this.nodeRemoveChildren(t);this.activeNode&&(n===this.activeNode||this.activeNode.isDescendantOf(n))&&this.activeNode.setActive(!1),this.focusNode&&(n===this.focusNode||this.focusNode.isDescendantOf(n))&&(this.focusNode=null),this.nodeRemoveMarkup(o),this.nodeRemoveChildren(o),_((r=e.inArray(n,a))>=0,"invalid child"),i.triggerModifyChild("remove",n),n.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,n),a.splice(r,1)},nodeRemoveChildMarkup:function(t){var n=t.node;n.ul&&(n.isRootNode()?e(n.ul).empty():(e(n.ul).remove(),n.ul=null),n.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(t){var n=t.tree,r=t.node;r.children&&(this.activeNode&&this.activeNode.isDescendantOf(r)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(r)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),e.extend({},t),r.triggerModifyChild("remove",null),r.visit(function(e){e.parent=null,n._callHook("treeRegisterNode",n,!1,e)}),r.lazy?r.children=[]:r.children=null,r.isRootNode()||(r.expanded=!1),this.nodeRenderStatus(t))},nodeRemoveMarkup:function(t){var n=t.node;n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,r,i,o,a){var s,l,d,c,u,h,f,p=t.node,g=t.tree,v=t.options,y=v.aria,b=!1,m=p.parent,x=!m,k=p.children,N=null;if(!1!==g._enableUpdate&&(x||m.ul)){if(_(x||m.ul,"parent UL must exist"),x||(p.li&&(r||p.li.parentNode!==p.parent.ul)&&(p.li.parentNode===p.parent.ul?N=p.li.nextSibling:this.debug("Unlinking "+p+" (must be child of "+p.parent+")"),this.nodeRemoveMarkup(t)),p.li?this.nodeRenderStatus(t):(b=!0,p.li=n.createElement("li"),p.li.ftnode=p,p.key&&v.generateIds&&(p.li.id=v.idPrefix+p.key),p.span=n.createElement("span"),p.span.className="fancytree-node",y&&e(p.li).attr("aria-labelledby","ftal_"+v.idPrefix+p.key),p.li.appendChild(p.span),this.nodeRenderTitle(t),v.createNode&&v.createNode.call(g,{type:"createNode"},t)),v.renderNode&&v.renderNode.call(g,{type:"renderNode"},t)),k){if(x||p.expanded||!0===i){for(p.ul||(p.ul=n.createElement("ul"),(!0!==o||a)&&p.expanded||(p.ul.style.display="none"),y&&e(p.ul).attr("role","group"),p.li?p.li.appendChild(p.ul):p.tree.$div.append(p.ul)),c=0,u=k.length;c<u;c++)f=e.extend({},t,{node:k[c]}),this.nodeRender(f,r,i,!1,!0);for(s=p.ul.firstChild;s;)(d=s.ftnode)&&d.parent!==p?(p.debug("_fixParent: remove missing "+d,s),h=s.nextSibling,s.parentNode.removeChild(s),s=h):s=s.nextSibling;for(s=p.ul.firstChild,c=0,u=k.length-1;c<u;c++)(l=k[c])!==(d=s.ftnode)?p.ul.insertBefore(l.li,d.li):s=s.nextSibling}}else p.ul&&(this.warn("remove child markup for "+p),this.nodeRemoveChildMarkup(t));x||b&&m.ul.insertBefore(p.li,N)}},nodeRenderTitle:function(t,n){var r,o,a,s,d,h=t.node,f=t.tree,p=t.options,g=p.aria,v=h.getLevel(),y=[];n!==i&&(h.title=n),h.span&&!1!==f._enableUpdate&&(v<p.minExpandLevel?(h.lazy||(h.expanded=!0),v>1&&(g?y.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>"):y.push("<span class='fancytree-expander fancytree-expander-fixed''></span>"))):g?y.push("<span role='button' class='fancytree-expander'></span>"):y.push("<span class='fancytree-expander'></span>"),p.checkbox&&!0!==h.hideCheckbox&&!h.isStatusNode()&&(g?y.push("<span role='checkbox' class='fancytree-checkbox'></span>"):y.push("<span class='fancytree-checkbox'></span>")),h.data.iconClass!==i&&(h.icon?e.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(h.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),h.icon=h.data.iconClass)),e.isFunction(p.icon)?null==(o=p.icon.call(f,{type:"icon"},t))&&(o=h.icon):o=null!=h.icon?h.icon:p.icon,null==o?o=!0:"boolean"!=typeof o&&(o=""+o),!1!==o&&(s=g?" role='img'":"","string"==typeof o?l.test(o)?(o="/"===o.charAt(0)?o:(p.imagePath||"")+o,y.push("<img src='"+o+"' class='fancytree-icon' alt='' />")):y.push("<span "+s+" class='fancytree-custom-icon "+o+"'></span>"):y.push("<span "+s+" class='fancytree-icon'></span>")),a="",p.renderTitle&&(a=p.renderTitle.call(f,{type:"renderTitle"},t)||""),a||(h.tooltip?d=h.tooltip:p.tooltip&&(d=!0===p.tooltip?h.title:p.tooltip.call(f,h)),d=d?" title='"+function(e){return(""+e).replace(c,function(e){return u[e]})}(d)+"'":"",r=g?" id='ftal_"+p.idPrefix+h.key+"'":"",a="<span "+(s=g?" role='treeitem'":"")+" class='fancytree-title'"+r+d+(p.titlesTabbable?" tabindex='0'":"")+">"+(p.escapeTitles?P(h.title):h.title)+"</span>"),y.push(a),h.span.innerHTML=y.join(""),this.nodeRenderStatus(t),p.enhanceTitle&&(t.$title=e(">span.fancytree-title",h.span),a=p.enhanceTitle.call(f,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var n=t.node,r=t.tree,i=t.options,o=n.hasChildren(),a=n.isLastSibling(),s=i.aria,l=e(n.span).find(".fancytree-title"),d=i._classNames,c=[],u=n[r.statusClassPropName];u&&!1!==r._enableUpdate&&(c.push(d.node),r.activeNode===n&&c.push(d.active),r.focusNode===n&&c.push(d.focused),n.expanded?(c.push(d.expanded),s&&l.attr("aria-expanded",!0)):s&&(o?l.attr("aria-expanded",!1):l.removeAttr("aria-expanded")),n.folder&&c.push(d.folder),!1!==o&&c.push(d.hasChildren),a&&c.push(d.lastsib),n.lazy&&null==n.children&&c.push(d.lazy),n.partload&&c.push(d.partload),n.partsel&&c.push(d.partsel),n.unselectable&&c.push(d.unselectable),n._isLoading&&c.push(d.loading),n._error&&c.push(d.error),n.statusNodeType&&c.push(d.statusNodePrefix+n.statusNodeType),n.selected?(c.push(d.selected),s&&l.attr("aria-selected",!0)):s&&l.attr("aria-selected",!1),n.extraClasses&&c.push(n.extraClasses),!1===o?c.push(d.combinedExpanderPrefix+"n"+(a?"l":"")):c.push(d.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(a?"l":"")),c.push(d.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),u.className=c.join(" "),n.li&&(n.li.className=a?d.lastsib:""))},nodeSetActive:function(t,n,r){r=r||{};var i,o=t.node,a=t.tree,s=t.options,l=!0===r.noEvents,d=!0===r.noFocus;return o===a.activeNode===(n=!1!==n)?S(o):n&&!l&&!1===this._triggerNodeEvent("beforeActivate",o,t.originalEvent)?C(o,["rejected"]):(n?(a.activeNode&&(_(a.activeNode!==o,"node was active (inconsistency)"),i=e.extend({},t,{node:a.activeNode}),a.nodeSetActive(i,!1),_(null===a.activeNode,"deactivate was out of sync?")),s.activeVisible&&o.makeVisible({scrollIntoView:d&&null==a.focusNode}),a.activeNode=o,a.nodeRenderStatus(t),d||a.nodeSetFocus(t),l||a._triggerNodeEvent("activate",o,t.originalEvent)):(_(a.activeNode===o,"node was not active (inconsistency)"),a.activeNode=null,this.nodeRenderStatus(t),l||t.tree._triggerNodeEvent("deactivate",o,t.originalEvent)),S(o))},nodeSetExpanded:function(t,n,r){r=r||{};var o,a,s,l,d,c,u=t.node,h=t.tree,f=t.options,p=!0===r.noAnimation,g=!0===r.noEvents;if(n=!1!==n,u.expanded&&n||!u.expanded&&!n)return S(u);if(n&&!u.lazy&&!u.hasChildren())return S(u);if(!n&&u.getLevel()<f.minExpandLevel)return C(u,["locked"]);if(!g&&!1===this._triggerNodeEvent("beforeExpand",u,t.originalEvent))return C(u,["rejected"]);if(p||u.isVisible()||(p=r.noAnimation=!0),a=new e.Deferred,n&&!u.expanded&&f.autoCollapse){d=u.getParentList(!1,!0),c=f.autoCollapse;try{for(f.autoCollapse=!1,s=0,l=d.length;s<l;s++)this._callHook("nodeCollapseSiblings",d[s],r)}finally{f.autoCollapse=c}}return a.done(function(){var e=u.getLastChild();n&&f.autoScroll&&!p&&e?e.scrollIntoView(!0,{topNode:u}).always(function(){g||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}):g||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}),o=function(r){var i=f.toggleEffect;if(u.expanded=n,h._callHook("nodeRender",t,!1,!1,!0),u.ul)if("none"!==u.ul.style.display===!!u.expanded)u.warn("nodeSetExpanded: UL.style.display already set");else{if(i&&!p)return void e(u.ul).toggle(i.effect,i.options,i.duration,function(){r()});u.ul.style.display=u.expanded||!parent?"":"none"}r()},n&&u.lazy&&u.hasChildren()===i?u.load().done(function(){a.notifyWith&&a.notifyWith(u,["loaded"]),o(function(){a.resolveWith(u)})}).fail(function(e){o(function(){a.rejectWith(u,["load failed ("+e+")"])})}):o(function(){a.resolveWith(u)}),a.promise()},nodeSetFocus:function(t,r){var i,o=t.tree,a=t.node,s=o.options,l=!!t.originalEvent&&e(t.originalEvent.target).is(":input");if(r=!1!==r,o.focusNode){if(o.focusNode===a&&r)return;i=e.extend({},t,{node:o.focusNode}),o.focusNode=null,this._triggerNodeEvent("blur",i),this._callHook("nodeRenderStatus",i)}r&&(this.hasFocus()||(a.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),a.makeVisible({scrollIntoView:!1}),o.focusNode=a,s.titlesTabbable?l||e(a.span).find(".fancytree-title").focus():0===e(n.activeElement).closest(".fancytree-container").length&&e(o.$container).focus(),s.aria&&e(o.$container).attr("aria-activedescendant","ftal_"+s.idPrefix+a.key),this._triggerNodeEvent("focus",t),s.autoScroll&&a.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(e,t){var n=e.node,r=e.tree,i=e.options;if(t=!1!==t,!n.unselectable){if(n.selected&&t||!n.selected&&!t)return!!n.selected;if(!1===this._triggerNodeEvent("beforeSelect",n,e.originalEvent))return!!n.selected;t&&1===i.selectMode?r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1):3===i.selectMode&&(n.selected=t,n.fixSelection3AfterClick()),n.selected=t,this.nodeRenderStatus(e),r.lastSelectedNode=t?n:null,r._triggerNodeEvent("select",e)}},nodeSetStatus:function(t,n,r,i){var o=t.node,a=t.tree;function s(t,n){var r=o.children?o.children[0]:null;return r&&r.isStatusNode()?(e.extend(r,t),r.statusNodeType=n,a._callHook("nodeRenderTitle",r)):(o._setChildren([t]),o.children[0].statusNodeType=n,a.render()),o.children[0]}switch(n){case"ok":!function(){var e=o.children?o.children[0]:null;if(e&&e.isStatusNode()){try{o.ul&&(o.ul.removeChild(e.li),e.li=null)}catch(e){}1===o.children.length?o.children=[]:o.children.shift()}}(),o._isLoading=!1,o._error=null,o.renderStatus();break;case"loading":o.parent||s({title:a.options.strings.loading+(r?" ("+r+")":""),checkbox:!1,tooltip:i},n),o._isLoading=!0,o._error=null,o.renderStatus();break;case"error":s({title:a.options.strings.loadError+(r?" ("+r+")":""),checkbox:!1,tooltip:i},n),o._isLoading=!1,o._error={message:r,details:i},o.renderStatus();break;case"nodata":s({title:a.options.strings.noData,checkbox:!1,tooltip:i},n),o._isLoading=!1,o._error=null,o.renderStatus();break;default:e.error("invalid node status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){return this.nodeSetSelected(e,!e.node.selected)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden")},treeInit:function(e){this.treeLoad(e)},treeLoad:function(t,n){var r,i,o,a=t.tree,s=t.widget.element,l=e.extend({},t,{node:this.rootNode});if(a.rootNode.children&&this.treeClear(t),n=n||this.options.source)"string"==typeof n&&e.error("Not implemented");else switch(i=s.data("type")||"html"){case"html":(o=s.find(">ul:first")).addClass("ui-fancytree-source ui-helper-hidden"),n=e.ui.fancytree.parseHtml(o),this.data=e.extend(this.data,T(o));break;case"json":n=e.parseJSON(s.text()),s.contents().filter(function(){return 3===this.nodeType}).remove(),e.isPlainObject(n)&&(_(e.isArray(n.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),r=n,n=n.children,delete r.children,e.extend(a.data,r));break;default:e.error("Invalid data-type: "+i)}return this.nodeLoadChildren(l,n).done(function(){a.render(),3===t.options.selectMode&&a.rootNode.fixSelection3FromEndNodes(),a.activeNode&&a.options.activeVisible&&a.activeNode.makeVisible(),a._triggerTreeEvent("init",null,{status:!0})}).fail(function(){a.render(),a._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){},treeSetFocus:function(t,n,r){(n=!1!==n)!==this.hasFocus()&&(this._hasFocus=n,!n&&this.focusNode?this.focusNode.setFocus(!1):!n||r&&r.calledByNode||e(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",n),this._triggerTreeEvent(n?"focusTree":"blurTree"),n&&!this.activeNode&&this.getFirstChild()&&this.getFirstChild().setFocus())},treeSetOption:function(t,n,i){var o=t.tree,a=!0,s=!1;switch(n){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":o._callHook("treeCreate",o),s=!0;break;case"escapeTitles":case"tooltip":s=!0;break;case"rtl":!1===i?o.$container.attr("DIR",null).removeClass("fancytree-rtl"):o.$container.attr("DIR","RTL").addClass("fancytree-rtl"),s=!0;break;case"source":a=!1,o._callHook("treeLoad",o,i),s=!0}o.debug("set option "+n+"="+i+" <"+(void 0===i?"undefined":r(i))+">"),a&&(this.widget._super?this.widget._super.call(this.widget,n,i):e.Widget.prototype._setOption.call(this.widget,n,i)),s&&o.render(!0,!1)}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!",moreData:"More&#8230;",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new F(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var t,n,r,o=this.options,a=o.extensions;this.tree;for(r=0;r<a.length;r++)n=a[r],(t=e.ui.fancytree._extensions[n])||e.error("Could not apply extension '"+n+"' (it is not registered, did you forget to include it?)"),this.tree.options[n]=e.extend(!0,{},t.options,this.tree.options[n]),_(this.tree.ext[n]===i,"Extension name must not exist as Fancytree.ext attribute: '"+n+"'"),this.tree.ext[n]={},w(this.tree,0,t,n),t;o.icons!==i&&(!0!==o.icon?e.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),o.icon=o.icons)),o.iconClass!==i&&(o.icon?e.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),o.icon=o.iconClass)),o.tabbable!==i&&(o.tabindex=o.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+o.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.unbind(t),this.tree.$container.unbind(t),e(n).unbind(t)},_bind:function(){var e=this,t=this.options,n=this.tree,r=n._ns;this._unbind(),n.$container.on("focusin"+r+" focusout"+r,function(e){var t=s.getNode(e),r="focusin"===e.type;t?n._callHook("nodeSetFocus",n._makeHookContext(t,e),r):n._callHook("treeSetFocus",n,r)}).on("selectstart"+r,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+r,function(e){if(t.disabled||!1===t.keyboard)return!0;var r,i=n.focusNode,o=n._makeHookContext(i||n,e),a=n.phase;try{return n.phase="userEvent","preventNav"===(r=i?n._triggerNodeEvent("keydown",i,e):n._triggerTreeEvent("keydown",e))?r=!0:!1!==r&&(r=n._callHook("nodeKeydown",o)),r}finally{n.phase=a}}).on("click"+r+" dblclick"+r,function(n){if(t.disabled)return!0;var r,i=s.getEventTarget(n),o=i.node,a=e.tree,l=a.phase;if(!o)return!0;r=a._makeHookContext(o,n);try{switch(a.phase="userEvent",n.type){case"click":return r.targetType=i.type,o.isPagingNode()?!0===a._triggerNodeEvent("clickPaging",r,n):!1!==a._triggerNodeEvent("click",r,n)&&a._callHook("nodeClick",r);case"dblclick":return r.targetType=i.type,!1!==a._triggerNodeEvent("dblclick",r,n)&&a._callHook("nodeDblclick",r)}}finally{a.phase=l}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),s=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.21.0",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:F,_FancytreeNodeClass:O,jquerySupports:{positionMyOfs:function(t,n,r,i){var o,a,s,l=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),d=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(o=0;o<d.length;o++)if((a=l[o]||0)!==(s=d[o]||0))return a>s;return!0}(e.ui.version,1,9)},assert:function(e,t){return _(e,t)},debounce:function(e,t,n,r){var i;return 3===arguments.length&&"boolean"!=typeof n&&(r=n,n=!1),function(){var o=arguments;r=r||this,n&&!i&&t.apply(r,o),clearTimeout(i),i=setTimeout(function(){n||t.apply(r,o),i=null},e)}},debug:function(t){e.ui.fancytree.debugLevel>=2&&k("log",arguments)},error:function(e){k("error",arguments)},escapeHtml:P,fixPositionOptions:function(t){if((t.offset||(""+t.my+t.at).indexOf("%")>=0)&&e.error("expected new position syntax (but '%' is not supported)"),!e.ui.fancytree.jquerySupports.positionMyOfs){var n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),r=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),i=(n[2]?+n[2]:0)+(r[2]?+r[2]:0),o=(n[4]?+n[4]:0)+(r[4]?+r[4]:0);t=e.extend({},t,{my:n[1]+" "+n[3],at:r[1]+" "+r[3]}),(i||o)&&(t.offset=i+" "+o)}return t},getEventTargetType:function(e){return this.getEventTarget(e).type},getEventTarget:function(t){var n=t&&t.target?t.target.className:"",r={node:this.getNode(t.target),type:i};return/\bfancytree-title\b/.test(n)?r.type="title":/\bfancytree-expander\b/.test(n)?r.type=!1===r.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(n)||/\bfancytree-radio\b/.test(n)?r.type="checkbox":/\bfancytree-icon\b/.test(n)?r.type="icon":/\bfancytree-node\b/.test(n)?r.type="title":t&&t.target&&e(t.target).closest(".fancytree-title").length&&(r.type="title"),r},getNode:function(e){if(e instanceof O)return e;for(e.selector!==i?e=e[0]:e.originalEvent!==i&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(t){var n;return t instanceof F?t:(t===i&&(t=0),"number"==typeof t?t=e(".fancytree-container").eq(t):"string"==typeof t?t=e(t).eq(0):t.selector!==i?t=t.eq(0):t.originalEvent!==i&&(t=e(t.target)),(n=(t=t.closest(":ui-fancytree")).data("ui-fancytree")||t.data("fancytree"))?n.tree:null)},eventToString:function(e){var t=e.which,n=e.type,r=[];return e.altKey&&r.push("alt"),e.ctrlKey&&r.push("ctrl"),e.metaKey&&r.push("meta"),e.shiftKey&&r.push("shift"),"click"===n||"dblclick"===n?r.push(p[e.button]+n):h[t]||r.push(f[t]||String.fromCharCode(t).toLowerCase()),r.join("+")},info:function(t){e.ui.fancytree.debugLevel>=1&&k("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(t,n,r){var i,o=t[n]||e.noop;t[n]=function(){try{return i=this._super,this._super=o,r.apply(this,arguments)}finally{this._super=i}}},parseHtml:function(t){var n,r,o,a,s,l,d,c,u=[];return t.find(">li").each(function(){var h,f,p=e(this),b=p.find(">span:first",this),x=b.length?null:p.find(">a:first"),_={tooltip:null,data:{}};for(b.length?_.title=b.html():x&&x.length?(_.title=x.html(),_.data.href=x.attr("href"),_.data.target=x.attr("target"),_.tooltip=x.attr("title")):(_.title=p.html(),(s=_.title.search(/<ul/i))>=0&&(_.title=_.title.substring(0,s))),_.title=e.trim(_.title),a=0,l=g.length;a<l;a++)_[g[a]]=i;for(n=this.className.split(" "),o=[],a=0,l=n.length;a<l;a++)r=n[a],v[r]?_[r]=!0:o.push(r);if(_.extraClasses=o.join(" "),(d=p.attr("title"))&&(_.tooltip=d),(d=p.attr("id"))&&(_.key=d),(h=T(p))&&!e.isEmptyObject(h)){for(f in m)h.hasOwnProperty(f)&&(h[m[f]]=h[f],delete h[f]);for(a=0,l=y.length;a<l;a++)d=y[a],null!=(c=h[d])&&(delete h[d],_[d]=c);e.extend(_.data,h)}(t=p.find(">ul:first")).length?_.children=e.ui.fancytree.parseHtml(t):_.children=_.lazy?i:null,u.push(_)}),u},registerExtension:function(t){_(null!=t.name,"extensions must have a `name` property."),_(null!=t.version,"extensions must have a `version` property."),e.ui.fancytree._extensions[t.name]=t},unescapeHtml:function(e){var t=n.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){k("warn",arguments)}})}function _(t,n){t||(n=n?": "+n:"",e.error("Fancytree assertion failed"+n))}function k(e,n){var r,i,o=t.console?t.console[e]:null;if(o)try{o.apply(t.console,n)}catch(e){for(i="",r=0;r<n.length;r++)i+=n[r];o(i)}}function N(e,t,n,r,i){return function(){var n=t[e],o=r[e],a=t.ext[i],s=function(){return n.apply(t,arguments)},l=function(e){return n.apply(t,e)};return function(){var e=t._local,n=t._super,r=t._superApply;try{return t._local=a,t._super=s,t._superApply=l,o.apply(t,arguments)}finally{t._local=e,t._super=n,t._superApply=r}}}()}function w(t,n,r,i){for(var o in r)"function"==typeof r[o]?"function"==typeof t[o]?t[o]=N(o,t,0,r,i):"_"===o.charAt(0)?t.ext[i][o]=N(o,t,0,r,i):e.error("Could not override tree."+o+". Use prefix '_' to create tree."+i+"._"+o):"options"!==o&&(t.ext[i][o]=r[o])}function S(t,n){return t===i?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function C(t,n){return t===i?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function E(e,t){return function(){e.resolveWith(t)}}function T(t){var n=e.extend({},t.data()),r=n.json;return delete n.fancytree,delete n.uiFancytree,r&&(delete n.json,n=e.extend(n,r)),n}function P(e){return(""+e).replace(d,function(e){return u[e]})}function A(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function O(t,n){var r,i,o,a;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},r=0,i=y.length;r<i;r++)this[o=y[r]]=n[o];for(o in n.data&&e.extend(this.data,n.data),n)b[o]||e.isFunction(n[o])||x[o]||(this.data[o]=n[o]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),_(this.key,"defaultKey() must return a unique key")):this.key="_"+s._nextNodeKey++:this.key=""+this.key,n.active&&(_(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),n.selected&&(this.tree.lastSelectedNode=this),(a=n.children)?a.length?this._setChildren(a):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function F(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&(e.isFunction(this.options.lazyload)&&!e.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return s.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),t.options.lazyload.apply(this,arguments)}),e.isFunction(this.options.loaderror)&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.options.fx!==i&&s.warn("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),this.options.removeNode!==i&&e.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.data=T(this.$div),this._id=e.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n,r={tree:this};this.rootNode=new O(r,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,n=e("<ul>",{class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=n,this.rootNode.ul=n[0],null==this.options.debugLevel&&(this.options.debugLevel=s.debugLevel),this.$container.attr("tabindex",this.options.tabindex),this.options.rtl&&this.$container.attr("DIR","RTL").addClass("fancytree-rtl"),this.options.aria&&(this.$container.attr("role","tree"),1!==this.options.selectMode&&this.$container.attr("aria-multiselectable",!0))}}(jQuery,window,document)},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(26));r.default.fn.cmfContextMenu=function(e){e=r.default.extend({delegate:null,actions:[],select:function(e,t){},wrapperTemplate:'<ul id="cmf-context-menu"></ul>',actionTemplate:'<li><i class="{{ iconClass }}"></i> {{ label }}</li>'},e);var t,n=(0,r.default)("body");(0,r.default)(this).on("contextmenu",e.delegate,function(i){i.preventDefault();var o=(0,r.default)(this);t&&t.remove();var a=e.actions;if("function"==typeof a&&(a=a(o)),!1!==a&&!r.default.isEmptyObject(a)){(t=function(){var t=(0,r.default)(e.wrapperTemplate),n=t.is("ul")?t:t.find("ul");for(var i in a){var o=a[i],s=(0,r.default)(function(){var t=e.actionTemplate;for(var n in o)o.hasOwnProperty(n)&&(t=t.replace("{{ "+n+" }}",o[n]));return t}());s.data("cmd",i),n.append(s)}return t}()).css({top:i.pageY,left:i.pageX}),n.append(t);var s=e.select;t.on("click","li",function(e){e.stopPropagation(),s(o,e)})}}),(0,r.default)("html").on("click",function(e){t&&t.remove()})}},function(e,t,n){var r=n(0)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(2),i=n(20),o=n(5),a=n(18),s=n(16),l=n(17),d=n(7),c=n(22),u=n(30),h=n(8);e.exports=function(e,t,n,f,p,g){var v=r[e],y=v,b=p?"set":"add",m=y&&y.prototype,x={},_=function(e){var t=m[e];o(m,e,"delete"==e?function(e){return!(g&&!d(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!d(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof y&&(g||m.forEach&&!c(function(){(new y).entries().next()}))){var k,N=new y,w=N[b](g?{}:-0,1)!=N,S=c(function(){N.has(1)});u(function(e){new y(e)})||((y=t(function(t,n){l(t,y,e);var r=new v;return void 0!=n&&s(n,p,r[b],r),r})).prototype=m,m.constructor=y),g||N.forEach(function(e,t){k=1/t==-1/0}),(S||k)&&(_("delete"),_("has"),p&&_("get")),(k||w)&&_(b),g&&m.clear&&delete m.clear}else y=f.getConstructor(t,e,p,b),a(y.prototype,n);return h(y,e),x[e]=y,i(i.G+i.W+i.F*(y!=v),x),g||f.setStrong(y,e,p),y}},function(e,t,n){"use strict";var r=n(2),i=n(3),o=n(13),a=n(0)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.setDesc(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(25),i=n(0)("iterator"),o=n(4);e.exports=n(6).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(21),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(4),i=n(0)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){var r=n(15);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){"use strict";var r=n(3),i=n(1),o=n(18),a=n(10),s=n(17),l=n(12),d=n(16),c=n(11),u=n(19),h=n(14)("id"),f=n(9),p=n(7),g=n(32),v=n(13),y=Object.isExtensible||p,b=v?"_s":"size",m=0,x=function(e,t){if(!p(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!f(e,h)){if(!y(e))return"F";if(!t)return"E";i(e,h,++m)}return"O"+e[h]},_=function(e,t){var n,r=x(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,i){var c=e(function(e,o){s(e,c,t),e._i=r.create(null),e._f=void 0,e._l=void 0,e[b]=0,void 0!=o&&d(o,n,e[i],e)});return o(c.prototype,{clear:function(){for(var e=this._i,t=this._f;t;t=t.n)t.r=!0,t.p&&(t.p=t.p.n=void 0),delete e[t.i];this._f=this._l=void 0,this[b]=0},delete:function(e){var t=_(this,e);if(t){var n=t.n,r=t.p;delete this._i[t.i],t.r=!0,r&&(r.n=n),n&&(n.p=r),this._f==t&&(this._f=n),this._l==t&&(this._l=r),this[b]--}return!!t},forEach:function(e){for(var t,n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!_(this,e)}}),v&&r.setDesc(c.prototype,"size",{get:function(){return l(this[b])}}),c},def:function(e,t,n){var r,i,o=_(e,t);return o?o.v=n:(e._l=o={i:i=x(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[b]++,"F"!==i&&(e._i[i]=o)),e},getEntry:_,setStrong:function(e,t,n){c(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))},n?"entries":"values",!n,!0),g(t)}}},function(e,t,n){"use strict";var r=n(37);n(31)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(24);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(39),i=n(12);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(0)("unscopables"),i=Array.prototype;void 0==i[r]&&n(1)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){"use strict";var r=n(41),i=n(19),o=n(4),a=n(40);e.exports=n(11)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){n(42);var r=n(2),i=n(1),o=n(4),a=n(0)("iterator"),s=r.NodeList,l=r.HTMLCollection,d=s&&s.prototype,c=l&&l.prototype,u=o.NodeList=o.HTMLCollection=o.Array;d&&!d[a]&&i(d,a,u),c&&!c[a]&&i(c,a,u)},function(e,t,n){"use strict";var r=n(3),i=n(23),o=n(8),a={};n(1)(a,n(0)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r.create(a,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=!1},function(e,t,n){var r=n(21),i=n(12);e.exports=function(e){return function(t,n){var o,a,s=String(i(t)),l=r(n),d=s.length;return l<0||l>=d?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===d||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(47)(!0);n(11)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(2),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,n){"use strict";var r=n(25),i={};i[n(0)("toStringTag")]="z",i+""!="[object z]"&&n(5)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){n(50),n(48),n(43),n(38),e.exports=n(6).Map},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.FancytreeAdapter=void 0;var i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(51));n(29),n(28),n(27),n(62),n(55);var s=new a.default;t.FancytreeAdapter=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!window.jQuery||!jQuery.fn.fancytree)throw"The FancytreeAdapter requires both jQuery and the FancyTree library.";if(!t.request)throw"The FancytreeAdapter requires a request option.";this.requestData=t.request,this.rootNode=t.root_node||"/",this.useCache=void 0===t.use_cache||t.use_cache,this.boundToInput=!1,this.sortableBy=void 0!=t.sortableBy&&t.sortableBy,t.dnd&&void 0==t.dnd.enabled&&(t.dnd.enabled=!0);var n=function(){return!0};if(this.dndOptions=jQuery.extend({enabled:!1,isNodeDraggable:n,nodeAcceptsDraggable:n},t.dnd),this.dndOptions.enabled&&!t.request.move)throw"The move request needs to be configured when drag 'n drop is enabled, pass it using the `request.move` option.";this.dndOptions.request=t.request.move,this.actions=new Array,this.tree=null,this.$tree=null,this.pathKeyMap={}}return o(e,[{key:"bindToElement",value:function(e){var t=this;if(this.$tree)throw"Cannot bind to multiple elements.";if(!e instanceof jQuery)throw"FancytreeAdapter can only be adapted to a jQuery object.";this.$tree=e;var n=this.actions,r=function(e,t){return"object"==(void 0===e?"undefined":i(e))&&e.hasOwnProperty("data")?function(e,t){var n="?"===e.substr(0,1),r=n?e.substr(1):e;if(void 0===t[r]){if(n)return;throw'Attribute "'+props[prop]+'" does not exists'}return t[r]}(e.data,t.descriptors):"function"==typeof e?e(requestNode):"string"==typeof e?e:void 0},o=function e(i){if(0!==i.length){if("//"==i.path||"/"==i.path)return e(i.children[Object.keys(i.children)[0]]);var o=i.path.replace("/","/").replace("//","/"),a=t.pathKeyMap[o]||""+jQuery.ui.fancytree._nextNodeKey++,s={title:i.label,key:a,children:[],actions:{},refPath:o,type:i.payload_type,unselectable:!0};for(var l in t.pathKeyMap[o]=a,i.descriptors.hasOwnProperty("icon")&&(s.icon=i.descriptors.icon),i.descriptors.hasOwnProperty("position")&&(s.position=i.descriptors.position),n){var d=n[l],c=r(d.url,i);void 0!==c&&(s.actions[l]={label:l,iconClass:d.icon,url:c})}var u=0;for(name in i.children)if(i.children.hasOwnProperty(name)){var h=e(i.children[name]);h&&s.children.push(h),u++}return 0!=u&&(s.folder=!0,s.lazy=!0,0===s.children.length&&(s.children=null)),s}},a=this.requestData,l=this.useCache,d={source:l&&s.has(this.rootNode)?s.get(this.rootNode):a.load(this.rootNode),lazyLoad:function(e,t){var n=t.node.data.refPath;if(l&&s.has(n))t.result=s.get(n);else{var r=a.load(n);Array.isArray(r)?t.result=r:t.result=jQuery.extend({data:{}},r)}},postProcess:function(e,t){if(t.hasOwnProperty("error")&&null!=t.error)t.result={error:"An error occured while retrieving the nodes: "+t.error};else{var n=o(t.response);1==(n=function(e,t){return t==e.refPath}(n,t.node.data.refPath)?n.children:[n]).length&&void 0!==n[0].folder&&(n[0].expanded=!0),t.result=n,l&&s.set(t.node.data.refPath,n)}},activeVisible:!0};this.sortableBy&&(d.sortChildren=function(e,n){var r=e.data[t.sortableBy],i=n.data[t.sortableBy];return r==i?0:r<i?-1:1}),this.dndOptions.enabled&&(d.extensions=["dnd"],d.dnd={dragStart:function(e,n){return t.dndOptions.isNodeDraggable(e,n)},dragEnter:function(e,n){return t.dndOptions.nodeAcceptsDraggable(e,n)},dragExpand:function(e,t){return!0},dragDrop:function(e,n){var r=n.otherNode,i=n.node,a=r.data.refPath,s=i.data.refPath,l="over"!=n.hitMode&&"child"!=n.hitMode,c=l?i.parent:i,u=c.data.refPath,h=u+"/"+a.substr(1+a.lastIndexOf("/")),f=r.icon,p=function(e){r.remove(),l&&c.children.forEach(function(t){t.data.position>=e.descriptors.position&&t.data.position++}),c.addChildren(o(e))},g=function(e,t){e.icon=t,r.renderTitle()};g(r,"fa fa-spinner fa-spin");var v=function(e){var t="Failed to move node",n=r.title;e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")&&(t+=": "+e.responseJSON.message);var i=null;e.hasOwnProperty("responseJSON")&&(i=e.responseJSON),r._error={message:t,details:i},r.renderStatus(),r.title+="["+t+"]",r.renderTitle(),console.error(t),g(r,f),setTimeout(function(){r._error=null,r.title=n,r.renderTitle(),r.renderStatus()},1e3)};t.requestData.move(a,h).done(function(e){l&&t.dndOptions.reorder?t.requestData.reorder(u,s,h,n.hitMode).done(function(e){p(e),d.hasOwnProperty("sortChildren")&&c.sortChildren(d.sortChildren,!0),g(r,f)}).fail(function(e){v(e),setTimeout(function(){t.requestData.move(h,a).done(function(e){d.hasOwnProperty("sortChildren")&&c.sortChildren(d.sortChildren,!0),g(r,f)})},1e3)}):(r.icon=f,p(e))}).fail(v)}}),this.$tree.fancytree(d),this.actions&&this.$tree.cmfContextMenu({delegate:"span.fancytree-title",wrapperTemplate:'<ul class="dropdown-menu" style="display:block;"></ul>',actionTemplate:'<li role="presentation"><a role="menuitem" href="{{ url }}"><i class="{{ iconClass }}"></i> {{ label }}</li>',actions:function(e){return jQuery.ui.fancytree.getNode(e).data.actions}}),this.tree=this.$tree.fancytree("getTree"),this.tree.getNodeByRefPath=function(e){return this.findFirst(function(t){return t.data.refPath==e})},this.$tree.fancytree("option","activate",function(e,n){t.boundToInput||(n.node.setActive(!1),n.node.setFocus(!1))})}},{key:"bindToInput",value:function(e){var t=this;this.boundToInput=!0,this.$tree.fancytree("option","activate",function(t,n){e.val(n.node.data.refPath)});var n=function(e){if(!t.pathKeyMap.hasOwnProperty(e)){for(var n=e.split("/");!t.pathKeyMap.hasOwnProperty(n.join("/"))&&n.pop(););if(0===n.length)return;var i=n.join("/");e.substr(i.length+1).split("/").forEach(function(e){t.pathKeyMap[i+="/"+e]=""+jQuery.ui.fancytree._nextNodeKey++})}t.tree.loadKeyPath(r(e),function(e,t){"ok"==t&&(e.setExpanded(),e.setActive())})},r=function(e){var n="",r="";return e.split("/").forEach(function(e){""!=e&&t.pathKeyMap.hasOwnProperty(r+="/"+e)&&(n+="/"+t.pathKeyMap[r])}),n};this.$tree.bind("fancytreeinit",function(t,r){n(e.val())}),e.on("change",function(e){n($(this).val())})}},{key:"addAction",value:function(e,t,n){this.actions[e]={url:t,icon:n}}}],[{key:"_resetCache",value:function(){s.clear()}}]),e}()},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(26)),i=n(52);r.default.fn.cmfTree=function(e){e=r.default.extend({adapter:null,request:{load:null},actions:{}},e);var t=(0,r.default)(this);if(!e.request.load)throw"cmfTree needs an AJAX URL to lazy load the tree, pass it using the `request.load` option.";e.adapter||(e.adapter=new i.FancytreeAdapter(e));var n=e.adapter;if(!n.bindToElement)throw"cmfTree adapters must have a bindToElement() method to specify the output element of the tree.";for(var o in e.actions)if(e.actions.hasOwnProperty(o)){if(!n.addAction)throw"The configured cmfTree adapter does not support actions, implement the addAction() method or use another adapter.";var a=e.actions[o];if(!a.url)throw'actions should have a url defined, "'+o+'" does not.';n.addAction(o,a.url,a.icon)}if(n.bindToElement(t),e.path_output){if(!n.bindToInput)throw"The configured cmfTree adapter does not support binding to an input field, implement the bindToInput() method or use another adapter.";n.bindToInput(function(e){if("string"==typeof e)return(0,r.default)(e);if(e instanceof r.default)return e;throw"Cannot handle selector "+e+". You may want to pass a jQuery object or a jQuery selector."}(e.path_output))}return n}},,function(e,t){},,,,,,,function(e,t){}]);